package io.github.confuser2188.exploitguard.module.check;

import io.github.confuser2188.exploitguard.Action;
import io.github.confuser2188.exploitguard.misc.BookNBT;
import io.github.confuser2188.exploitguard.module.Check;
import io.github.confuser2188.exploitguard.module.Module;
import io.github.confuser2188.packetlistener.FieldName;
import io.github.confuser2188.packetlistener.Reflection;
import io.github.confuser2188.packetlistener.event.ReceivedPacketEvent;
import io.github.confuser2188.packetlistener.minecraft.ItemStack;
import org.bukkit.event.EventHandler;

public class BookClick extends Module{

    public BookClick() {
        super(Check.BOOK_CLICK);
    }

    @EventHandler
    public void onPacketReceive(ReceivedPacketEvent event) {
        if (!this.isEnabled() || !event.getPacketName().equals("PacketPlayInWindowClick"))
            return;

        try {
            ItemStack itemStack = new ItemStack(Reflection.getFieldValue(event.getPacket(), FieldName.WINDOWCLICK_ITEMSTACK.getName()));

            if(BookNBT.checkInvalidNBT(itemStack))
            {
                Action.run(event.getPlayer(), this.getCheckType());
                event.setCancelled(true);
            }
        } catch (Exception ex) {
            ex.printStackTrace();
        }
    }
}
