package io.github.confuser2188.exploitguard.module.check;

import io.github.confuser2188.exploitguard.Action;
import io.github.confuser2188.exploitguard.Main;
import io.github.confuser2188.exploitguard.misc.BookNBT;
import io.github.confuser2188.exploitguard.module.Check;
import io.github.confuser2188.exploitguard.module.Module;
import io.github.confuser2188.packetlistener.FieldName;
import io.github.confuser2188.packetlistener.Reflection;
import io.github.confuser2188.packetlistener.event.ReceivedPacketEvent;
import io.github.confuser2188.packetlistener.minecraft.ItemStack;
import org.bukkit.event.EventHandler;

public class BookPlace extends Module{

    public BookPlace() {
        super(Check.BOOK_PLACE);
    }

    @EventHandler
    public void onPacketReceive(ReceivedPacketEvent event) {
        if (!this.isEnabled())
            return;

        if(Main.getServerVersion().startsWith("v1_8"))
            if (event.getPacketName().equals("PacketPlayInBlockPlace"))
                try {
                    ItemStack itemStack = new ItemStack(Reflection.getFieldValue(event.getPacket(), FieldName.BLOCKPLACE_ITEMSTACK.getName()));

                    if(BookNBT.checkInvalidNBT(itemStack))
                    {
                        Action.run(event.getPlayer(), this.getCheckType());
                        event.setCancelled(true);
                    }
                } catch (Exception ex) {
                    ex.printStackTrace();
                }
    }
}
