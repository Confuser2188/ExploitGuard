package io.github.confuser2188.packetlistener.minecraft;

import io.github.confuser2188.packetlistener.FieldName;
import io.github.confuser2188.packetlistener.Reflection;
import io.netty.buffer.ByteBuf;

import java.lang.reflect.Method;

public class PacketDataSerializer {

    private Object packetDataSerializer;

    public PacketDataSerializer(Object packetDataSerializer) {
        this.packetDataSerializer = packetDataSerializer;
    }

    public Object getPacketDataSerializerObject() {
        return this.packetDataSerializer;
    }

    public ByteBuf getByteBuf() throws Exception{
        return (ByteBuf) Reflection.getFieldValue(packetDataSerializer, "a");
    }

    public void setByteBuf(ByteBuf byteBuf) throws Exception{
        Reflection.setFieldValue(packetDataSerializer, "a", byteBuf);
    }

    public short readShort() throws Exception{
        Method method = packetDataSerializer.getClass().getMethod("readShort");
        return (short) method.invoke(packetDataSerializer);
    }

    public byte readByte() throws Exception{
        Method method = packetDataSerializer.getClass().getMethod("readByte");
        return (byte) method.invoke(packetDataSerializer);
    }

    public NBTTagCompound getNBTTagCompound() throws Exception{
        Method method = packetDataSerializer.getClass().getMethod(FieldName.NBTTAGCOMPOUND_METHOD.getName());
        return new NBTTagCompound(method.invoke(packetDataSerializer), (byte)0);
    }
}
