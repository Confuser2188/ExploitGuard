package io.github.confuser2188.packetlistener_eg.minecraft;

import io.github.confuser2188.packetlistener_eg.FieldName;
import io.github.confuser2188.packetlistener_eg.Reflection;
import io.netty.buffer.ByteBuf;

import java.lang.reflect.Method;

public class PacketDataSerializer {

    private Object packetDataSerializer;

    public PacketDataSerializer(Object packetDataSerializer) {
        this.packetDataSerializer = packetDataSerializer;
    }

    public Object getPacketDataSerializerObject() {
        return this.packetDataSerializer;
    }

    public ByteBuf getByteBuf() throws Exception{
        return (ByteBuf) Reflection.getFieldValue(packetDataSerializer, "a");
    }

    public void setByteBuf(ByteBuf byteBuf) throws Exception{
        Reflection.setFieldValue(packetDataSerializer, "a", byteBuf);
    }

    public short readShort() throws Exception{
        Method method = packetDataSerializer.getClass().getMethod("readShort");
        return (short) method.invoke(packetDataSerializer);
    }

    public byte readByte() throws Exception{
        Method method = packetDataSerializer.getClass().getMethod("readByte");
        return (byte) method.invoke(packetDataSerializer);
    }

    public NBTTagCompound getNBTTagCompound() {
        try{
            Method method = packetDataSerializer.getClass().getMethod(FieldName.NBTTAGCOMPOUND_METHOD.getName());
            return new NBTTagCompound(method.invoke(packetDataSerializer), (byte)0);
        }catch(Exception ex) { return null; }
    }
}
